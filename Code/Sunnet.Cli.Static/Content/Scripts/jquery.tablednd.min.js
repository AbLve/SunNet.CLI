!function(n,t,i,r){var u="ontouchstart"in i.documentElement,f=u?"touchstart":"mousedown",e=u?"touchmove":"mousemove",o=u?"touchend":"mouseup";u&&n.each("touchstart touchmove touchend".split(" "),function(t,i){n.event.fixHooks[i]=n.event.mouseHooks});n(i).ready(function(){function t(n){for(var i={},t=n.match(/([^;:]+)/g)||[];t.length;)i[t.shift()]=t.shift().trim();return i}n("table").each(function(){n(this).data("table")=="dnd"&&n(this).tableDnD({onDragStyle:n(this).data("ondragstyle")&&t(n(this).data("ondragstyle"))||null,onDropStyle:n(this).data("ondropstyle")&&t(n(this).data("ondropstyle"))||null,onDragClass:n(this).data("ondragclass")==r&&"tDnD_whileDrag"||n(this).data("ondragclass"),onDrop:n(this).data("ondrop")&&new Function("table","row",n(this).data("ondrop")),onDragStart:n(this).data("ondragstart")&&new Function("table","row",n(this).data("ondragstart")),scrollAmount:n(this).data("scrollamount")||5,sensitivity:n(this).data("sensitivity")||10,hierarchyLevel:n(this).data("hierarchylevel")||0,indentArtifact:n(this).data("indentartifact")||'<div class="indent">&nbsp;<\/div>',autoWidthAdjust:n(this).data("autowidthadjust")||!0,autoCleanRelations:n(this).data("autocleanrelations")||!0,jsonPretifySeparator:n(this).data("jsonpretifyseparator")||"\t",serializeRegexp:n(this).data("serializeregexp")&&new RegExp(n(this).data("serializeregexp"))||/[^\-]*$/,serializeParamName:n(this).data("serializeparamname")||!1,dragHandle:n(this).data("draghandle")||null})})});jQuery.tableDnD={currentTable:null,dragObject:null,mouseOffset:null,oldX:0,oldY:0,build:function(t){return this.each(function(){this.tableDnDConfig=n.extend({onDragStyle:null,onDropStyle:null,onDragClass:"tDnD_whileDrag",onDrop:null,onDragStart:null,scrollAmount:5,sensitivity:10,hierarchyLevel:0,indentArtifact:'<div class="indent">&nbsp;<\/div>',autoWidthAdjust:!0,autoCleanRelations:!0,jsonPretifySeparator:"\t",serializeRegexp:/[^\-]*$/,serializeParamName:!1,dragHandle:null},t||{});n.tableDnD.makeDraggable(this);this.tableDnDConfig.hierarchyLevel&&n.tableDnD.makeIndented(this)}),this},makeIndented:function(t){var u=t.tableDnDConfig,r=t.rows,f=n(r).first().find("td:first")[0],e=0,h=0,o,s,i;if(n(t).hasClass("indtd"))return null;for(s=n(t).addClass("indtd").attr("style"),n(t).css({whiteSpace:"nowrap"}),i=0;i<r.length;i++)h<n(r[i]).find("td:first").text().length&&(h=n(r[i]).find("td:first").text().length,o=i);for(n(f).css({width:"auto"}),i=0;i<u.hierarchyLevel;i++)n(r[o]).find("td:first").prepend(u.indentArtifact);for(f&&n(f).css({width:f.offsetWidth}),s&&n(t).css(s),i=0;i<u.hierarchyLevel;i++)n(r[o]).find("td:first").children(":first").remove();return u.hierarchyLevel&&n(r).each(function(){e=n(this).data("level")||0;e<=u.hierarchyLevel&&n(this).data("level",e)||n(this).data("level",0);for(var t=0;t<n(this).data("level");t++)n(this).find("td:first").prepend(u.indentArtifact)}),this},makeDraggable:function(t){var i=t.tableDnDConfig;i.dragHandle&&n(i.dragHandle,t).each(function(){n(this).bind(f,function(r){return n.tableDnD.initialiseDrag(n(this).parents("tr")[0],t,this,r,i),!1})})||n(t.rows).each(function(){n(this).hasClass("nodrag")||n(this).bind(f,function(r){if(r.target.tagName=="TD")return n.tableDnD.initialiseDrag(this,t,this,r,i),!1}).css("cursor","move")})},currentOrder:function(){var t=this.currentTable.rows;return n.map(t,function(t){return(n(t).data("level")+t.id).replace(/\s/g,"")}).join("")},initialiseDrag:function(t,r,u,f,s){this.dragObject=t;this.currentTable=r;this.mouseOffset=this.getMouseOffset(u,f);this.originalOrder=this.currentOrder();n(i).bind(e,this.mousemove).bind(o,this.mouseup);s.onDragStart&&s.onDragStart(r,u)},updateTables:function(){this.each(function(){this.tableDnDConfig&&n.tableDnD.makeDraggable(this)})},mouseCoords:function(n){return u?{x:event.changedTouches[0].clientX,y:event.changedTouches[0].clientY}:n.pageX||n.pageY?{x:n.pageX,y:n.pageY}:{x:n.clientX+i.body.scrollLeft-i.body.clientLeft,y:n.clientY+i.body.scrollTop-i.body.clientTop}},getMouseOffset:function(n,i){var r,u;return i=i||t.event,u=this.getPosition(n),r=this.mouseCoords(i),{x:r.x-u.x,y:r.y-u.y}},getPosition:function(n){var t=0,i=0;for(n.offsetHeight==0&&(n=n.firstChild);n.offsetParent;)t+=n.offsetLeft,i+=n.offsetTop,n=n.offsetParent;return t+=n.offsetLeft,i+=n.offsetTop,{x:t,y:i}},autoScroll:function(n){var r=this.currentTable.tableDnDConfig,u=t.pageYOffset,f=t.innerHeight?t.innerHeight:i.documentElement.clientHeight?i.documentElement.clientHeight:i.body.clientHeight;i.all&&(typeof i.compatMode!="undefined"&&i.compatMode!="BackCompat"?u=i.documentElement.scrollTop:typeof i.body!="undefined"&&(u=i.body.scrollTop));n.y-u<r.scrollAmount&&t.scrollBy(0,-r.scrollAmount)||f-(n.y-u)<r.scrollAmount&&t.scrollBy(0,r.scrollAmount)},moveVerticle:function(n,t){0!=n.vertical&&t&&this.dragObject!=t&&this.dragObject.parentNode==t.parentNode&&(0>n.vertical&&this.dragObject.parentNode.insertBefore(this.dragObject,t.nextSibling)||0<n.vertical&&this.dragObject.parentNode.insertBefore(this.dragObject,t))},moveHorizontal:function(t,i){var u=this.currentTable.tableDnDConfig,r;if(!u.hierarchyLevel||0==t.horizontal||!i||this.dragObject!=i)return null;r=n(i).data("level");0<t.horizontal&&r>0&&n(i).find("td:first").children(":first").remove()&&n(i).data("level",--r);0>t.horizontal&&r<u.hierarchyLevel&&n(i).prev().data("level")>=r&&n(i).children(":first").prepend(u.indentArtifact)&&n(i).data("level",++r)},mousemove:function(t){var r=n(n.tableDnD.dragObject),u=n.tableDnD.currentTable.tableDnDConfig,f,i,e,s,o;return(t&&t.preventDefault(),!n.tableDnD.dragObject)?!1:(t.type=="touchmove"&&event.preventDefault(),u.onDragClass&&r.addClass(u.onDragClass)||r.css(u.onDragStyle),i=n.tableDnD.mouseCoords(t),s=i.x-n.tableDnD.mouseOffset.x,o=i.y-n.tableDnD.mouseOffset.y,n.tableDnD.autoScroll(i),f=n.tableDnD.findDropTargetRow(r,o),e=n.tableDnD.findDragDirection(s,o),n.tableDnD.moveVerticle(e,f),n.tableDnD.moveHorizontal(e,f),!1)},findDragDirection:function(n,t){var i=this.currentTable.tableDnDConfig.sensitivity,r=this.oldX,u=this.oldY,e=r-i,o=r+i,s=u-i,h=u+i,f={horizontal:n>=e&&n<=o?0:n>r?-1:1,vertical:t>=s&&t<=h?0:t>u?-1:1};return f.horizontal!=0&&(this.oldX=n),f.vertical!=0&&(this.oldY=t),f},findDropTargetRow:function(t,i){for(var u=0,o=this.currentTable.rows,s=this.currentTable.tableDnDConfig,f=0,r=null,e=0;e<o.length;e++)if(r=o[e],f=this.getPosition(r).y,u=parseInt(r.offsetHeight)/2,r.offsetHeight==0&&(f=this.getPosition(r.firstChild).y,u=parseInt(r.firstChild.offsetHeight)/2),i>f-u&&i<f+u)return t.is(r)||s.onAllowDrop&&!s.onAllowDrop(t,r)||n(r).hasClass("nodrop")?null:r;return null},processMouseup:function(){var t=this.currentTable.tableDnDConfig,u=this.dragObject,f=0,r=0;if(!this.currentTable||!u)return null;n(i).unbind(e,this.mousemove).unbind(o,this.mouseup);t.hierarchyLevel&&t.autoCleanRelations&&n(this.currentTable.rows).first().find("td:first").children().each(function(){r=n(this).parents("tr:first").data("level");r&&n(this).parents("tr:first").data("level",--r)&&n(this).remove()})&&t.hierarchyLevel>1&&n(this.currentTable.rows).each(function(){if(r=n(this).data("level"),r>1)for(f=n(this).prev().data("level");r>f+1;)n(this).find("td:first").children(":first").remove(),n(this).data("level",--r)});t.onDragClass&&n(u).removeClass(t.onDragClass)||n(u).css(t.onDropStyle);this.dragObject=null;t.onDrop&&this.originalOrder!=this.currentOrder()&&n(u).hide().fadeIn("fast")&&t.onDrop(this.currentTable,u);this.currentTable=null},mouseup:function(t){return t&&t.preventDefault(),n.tableDnD.processMouseup(),!1},jsonize:function(n){var t=this.currentTable;return n?JSON.stringify(this.tableData(t),null,t.tableDnDConfig.jsonPretifySeparator):JSON.stringify(this.tableData(t))},serialize:function(){return n.param(this.tableData(this.currentTable))},serializeTable:function(n){for(var t,i="",f=n.tableDnDConfig.serializeParamName||n.id,u=n.rows,r=0;r<u.length;r++)i.length>0&&(i+="&"),t=u[r].id,t&&n.tableDnDConfig&&n.tableDnDConfig.serializeRegexp&&(t=t.match(n.tableDnDConfig.serializeRegexp)[0],i+=f+"[]="+t);return i},serializeTables:function(){var t=[];return n("table").each(function(){this.id&&t.push(n.param(this.tableData(this)))}),t.join("&")},tableData:function(t){var u=t.tableDnDConfig,f=[],l=0,s=0,h=null,c={},a,v,i,r,e,o;if(t||(t=this.currentTable),!t||!t.id||!t.rows||!t.rows.length)return{error:{code:500,message:"Not a valid table, no serializable unique id provided."}};for(r=u.autoCleanRelations&&t.rows||n.makeArray(t.rows),v=u.serializeParamName||t.id,i=v,a=function(n){return n&&u&&u.serializeRegexp?n.match(u.serializeRegexp)[0]:n},c[i]=[],!u.autoCleanRelations&&n(r[0]).data("level")&&r.unshift({id:"undefined"}),e=0;e<r.length;e++)if(u.hierarchyLevel){if(s=n(r[e]).data("level")||0,s==0)i=v,f=[];else if(s>l)f.push([i,l]),i=a(r[e-1].id);else if(s<l)for(o=0;o<f.length;o++)f[o][1]==s&&(i=f[o][0]),f[o][1]>=l&&(f[o][1]=0);l=s;n.isArray(c[i])||(c[i]=[]);h=a(r[e].id);h&&c[i].push(h)}else h=a(r[e].id),h&&c[i].push(h);return c}};jQuery.fn.extend({tableDnD:n.tableDnD.build,tableDnDUpdate:n.tableDnD.updateTables,tableDnDSerialize:n.proxy(n.tableDnD.serialize,n.tableDnD),tableDnDSerializeAll:n.tableDnD.serializeTables,tableDnDData:n.proxy(n.tableDnD.tableData,n.tableDnD)})}(jQuery,window,window.document);
//# sourceMappingURL=jquery.tablednd.min.js.map
